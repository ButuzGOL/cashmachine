!function(){window.EmberApp=Ember.Application.create({LOG_TRANSITIONS:!0,LOG_TRANSITIONS_INTERNAL:!0})}(),function(){EmberApp.config={apiRoot:"http://localhost:1337"}}(),function(){EmberApp.ApplicationController=Ember.ObjectController.extend({needs:["sessionsNew"],isAuthenticated:function(){return!Ember.isEmpty(this.get("controllers.sessionsNew.currentCard"))}.property("controllers.sessionsNew.currentCard")})}(),function(){EmberApp.CardBalanceController=Ember.ObjectController.extend({errorMessage:null,money:null,currentOperation:null,reset:function(){this.setProperties({currentOperation:null,money:null})},actions:{take:function(){var a=this;this.set("errorMessage",null),this.get("model").take(this.get("money")).then(function(b){var c=a.store.createRecord("operation",b);a.set("currentOperation",c),a.set("money",null)}).fail(function(b){a.set("errorMessage",b.responseJSON.message)})}}})}(),function(){EmberApp.SessionsNewController=Ember.ObjectController.extend({needs:["sessionsNew"],number:"",pin:"",errorMessage:"",stage:0,currentCard:null,token:null,isFirstStage:Ember.computed.equal("stage",0),isSecondStage:Ember.computed.equal("stage",1),reset:function(){this.setProperties({number:null,pin:null,stage:0})},actions:{signin:function(){var a=this,b=this.get("stage"),c={number:this.get("number").replace(/-/g,"")};1===b&&(c.pin=this.get("pin")),a.set("errorMessage",null),Ember.$.post(EmberApp.config.apiRoot+"/signin",c).then(function(c){0===b?a.set("stage",1):a.store.find("card","me").then(function(b){a.setProperties({currentCard:b,token:c.sessionId}),a.transitionTo("index")},function(){a.set("errorMessage","Error")})},function(b){a.set("errorMessage",b.responseJSON.message)})},cancel:function(){this.reset()}}})}(),function(){EmberApp.ApplicationAdapter=DS.RESTAdapter.extend({host:EmberApp.config.apiRoot}),EmberApp.ApplicationSerializer=DS.RESTSerializer.extend({normalizePayload:function(a,b){return"EmberApp.Card"===a.toString()?(b.links={operations:"/cards/me/operations"},{card:b}):"EmberApp.Operation"===a.toString()?{operations:b}:void 0}})}(),function(){EmberApp.Card=DS.Model.extend({balance:DS.attr("number"),operations:DS.hasMany("operation",{async:!0}),take:function(a){var b=this;return Ember.$.ajax({url:EmberApp.config.apiRoot+"/cards/"+this.id+"/balance",method:"PUT",data:{take:a}}).done(function(){b.set("balance",b.get("balance")-a)})}})}(),function(){EmberApp.Operation=DS.Model.extend({code:DS.attr("number"),card:DS.belongsTo("card")})}(),function(){EmberApp.ApplicationRoute=Ember.Route.extend({actions:{signout:function(){Ember.$.get(EmberApp.config.apiRoot+"/signout").done(function(){this.controllerFor("sessions.new").set("currentCard",null),this.transitionTo("sessions.new")}.bind(this))}}})}(),function(){EmberApp.AuthenticatedRoute=Ember.Route.extend({beforeModel:function(a){Ember.isEmpty(this.controllerFor("sessions.new").get("currentCard"))&&this.redirectToSignin(a)},redirectToSignin:function(){this.transitionTo("sessions.new")},actions:{error:function(a){401===a.status?this.redirectToSignin():console.log("unknown problem")}}})}(),function(){EmberApp.CardRoute=EmberApp.AuthenticatedRoute.extend({model:function(){return this.controllerFor("sessions.new").get("currentCard")}})}(),function(){EmberApp.CardBalanceRoute=EmberApp.AuthenticatedRoute.extend({renderTemplate:function(){this.render({into:"application"})},model:function(){return this.controllerFor("sessions.new").get("currentCard")},setupController:function(a,b){this._super(a,b),a.reset()}})}(),function(){EmberApp.CardOperationsRoute=EmberApp.AuthenticatedRoute.extend({model:function(){return this.controllerFor("sessions.new").get("currentCard").get("operations")}})}(),function(){EmberApp.IndexRoute=EmberApp.AuthenticatedRoute.extend({})}(),function(){EmberApp.SessionsNewRoute=Ember.Route.extend({setupController:function(a){a.reset()}})}(),function(){EmberApp.SessionsNewView=Ember.View.extend({didInsertElement:function(){var a=this;this._super(),this.get("controller.controllers.sessionsNew").addObserver("stage",function(b){0!==b.get("stage")||a.isDestroyed||a.rerender()}),this.initNumberMask()},initNumberMask:function(){Ember.$("#number").mask("999-999-999")}})}(),function(){Ember.Router.map(function(){this.resource("cards",function(){this.resource("card",{path:"/:card_id"},function(){this.route("operations"),this.route("balance")})}),this.resource("sessions",function(){this.route("new")})})}(),function(){Ember.$.ajaxSetup({dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0}),$.cookie.json=!0}();