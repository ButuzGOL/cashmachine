"use strict";function auth(a,b,c){function d(c){return a.post(b+"/signin",c)}function e(){return a.get(b+"/signout")}function f(){return Boolean(c.currentCard)}var g={signin:d,signout:e,isSignin:f};return g}function SessionsNewController(a,b,c,d,e,f,g){function h(){j.number=null,j.pin=null,j.stage=0,j.errorMessage=null}function i(){var a={number:j.number.replace(/-/g,"")};1===j.stage&&(a.pin=j.pin),j.errorMessage=null,e.signin(a).then(function(){0===j.stage?j.stage=1:f.get({id:"me"}).$promise.then(function(a){b.currentCard=a,d.path("/"),g({title:"Congratulations!",content:"You signin.",type:"material",duration:3,dismissable:!1})},function(){j.errorMessage="Error"})},function(a){j.errorMessage=a.data.message})}var j=this;j.signin=i,j.reset=h,j.reset()}angular.module("cashmachineApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","mgcrea.ngStrap","ngMockE2E","cashmachineApp.home","cashmachineApp.sessions","cashmachineApp.cards"]).config(["$routeProvider",function(a){a.otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(a){a.defaults.withCredentials=!0,a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"],a.responseInterceptors.push(["$q","$location",function(a,b){return function(c){return c.then(function(a){return a},function(c){return 401===c.status&&b.url("/sessions/new"),a.reject(c)})}}])}]),angular.module("cashmachineApp").run(["$location","auth","$rootScope",function(a,b,c){var d=["/sessions/new"],e=function(a){return-1!==d.indexOf(a)};c.$on("$routeChangeStart",function(){b.isSignin()||e(a.url())||a.path("/sessions/new")})}]),angular.module("cashmachineApp").constant("APIROOT","http://localhost:1337"),angular.module("cashmachineApp").run(["$httpBackend",function(a){function b(){return Math.floor(9999*Math.random()+1)}a.whenGET(/\.html/).passThrough(),a.whenPOST(/.*?\/signin/).respond(function(a,c,d){return d=angular.fromJson(d),"111111111"!==d.number||"111"!==d.pin&&"undefined"!=typeof d.pin?[400,{message:"Wrong data"}]:[200,{id:b()}]}),a.whenGET(/.*?\/signout/).respond(204),a.whenGET(/.*?\/cards\/.*?\/operations/).respond([{code:1,owner:b(),createdAt:"2014-11-12T07:37:28.165Z",updatedAt:"2014-11-12T07:37:28.165Z",id:b()},{code:1,owner:b(),createdAt:"2014-11-12T07:37:29.338Z",updatedAt:"2014-11-12T07:37:29.338Z",id:b()},{code:1,owner:b(),createdAt:"2014-11-12T07:37:54.804Z",updatedAt:"2014-11-12T07:37:54.804Z",id:b()}]),a.whenPUT(/.*?\/cards\/.*?\/balance/).respond(function(a,c,d){return d=angular.fromJson(d),d.take<0?[400,{message:"Should be more than zero"}]:d.take>9999?[400,{message:"Not enough balance"}]:[200,{code:2,createdAt:"2014-11-15T07:24:23.497Z",id:b()}]}),a.whenGET(/.*?\/cards\/.*?/).respond({id:b(),balance:9999})}]),angular.module("cashmachineApp").directive("maskedInput",function(){return{restrict:"A",link:function(a,b){$(b).mask("999-999-999")}}}),angular.module("cashmachineApp").factory("auth",auth),auth.$inject=["$http","APIROOT","$rootScope"],angular.module("cashmachineApp.cards",["ngRoute"]).config(["$routeProvider",function(a){a.when("/cards/:id",{templateUrl:"scripts/cards/view/view.html",controller:"CardsViewController",controllerAs:"vm"}).when("/cards/:id/balance",{templateUrl:"scripts/cards/balance/balance.html",controller:"CardsBalanceController",controllerAs:"vm"})}]),angular.module("cashmachineApp.cards").controller("CardsViewController",["$scope","CardOperation",function(a,b){function c(){b.index().$promise.then(function(a){d.showOperations=!0,d.cardOperations=a})}var d=this;d.fetchOperations=c,d.cardOpertions=[],d.showOperations=!1}]),angular.module("cashmachineApp.cards").controller("CardsBalanceController",["Card","$rootScope",function(a,b){function c(){e.operation=null,e.errorMessage=null,e.money=0}function d(){e.errorMessage=null,a.take(e.money).then(function(a){e.operation=a.data,b.currentCard.balance-=e.money,e.money=0},function(a){e.errorMessage=a.data.message})}var e=this;e.take=d,e.reset=c,e.reset()}]),angular.module("cashmachineApp.cards").directive("cardOperation",function(){return{templateUrl:"scripts/cards/common/directives/card-operation.html",restrict:"E",scope:{operation:"="}}}),angular.module("cashmachineApp.cards").factory("CardOperation",["APIROOT","$resource",function(a,b){return b(a+"/cards/me/operations",{},{index:{method:"GET",isArray:!0}})}]),angular.module("cashmachineApp.cards").factory("Card",["APIROOT","$resource","$http",function(a,b,c){var d=b(a+"/cards/:id",{id:"@id"});return d.take=function(b){return c.put(a+"/cards/:id/balance",{id:"@id",take:b})},d}]),angular.module("cashmachineApp").controller("NavCotroller",["$scope","auth","$location","$rootScope","$alert",function(a,b,c,d,e){function f(){b.signout().then(function(){d.currentCard=null,c.path("/sessions/new"),e({title:"Congratulations!",content:"You signout.",type:"material",duration:3,dismissable:!1})})}var g=this;g.signout=f}]),angular.module("cashmachineApp.home",["ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"scripts/home/home.html",controller:"HomeController",controllerAs:"vm"})}]),angular.module("cashmachineApp.home").controller("HomeController",function(){}),angular.module("cashmachineApp.sessions",["ngRoute"]).config(["$routeProvider",function(a){a.when("/sessions/new",{templateUrl:"scripts/sessions/new.html",controller:"SessionsNewController",controllerAs:"vm"})}]),angular.module("cashmachineApp.sessions").controller("SessionsNewController",SessionsNewController),SessionsNewController.$inject=["$scope","$rootScope","$log","$location","auth","Card","$alert"];